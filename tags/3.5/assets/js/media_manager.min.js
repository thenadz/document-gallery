(function(g,f){var a=wp.media;l10n=a.view.l10n="undefined"===typeof _wpMediaViewsL10n?{}:_wpMediaViewsL10n;jQuery.extend(l10n,DGl10n);a.controller.DocumentGalleryEdit=a.controller.Library.extend({defaults:{id:"document-gallery-edit",title:l10n.editDocumentGalleryTitle,multiple:!1,searchable:!1,sortable:!0,display:!1,content:"browse",toolbar:"document-gallery-edit",describe:!0,displaySettings:!0,dragInfo:!0,idealColumnWidth:170,editing:!1,priority:60,syncSelection:!1},initialize:function(){this.get("library")||
this.set("library",new a.model.Selection);this.get("AttachmentView")||this.set("AttachmentView",a.view.Attachment.EditLibrary);a.controller.Library.prototype.initialize.apply(this,arguments)},activate:function(){this.get("library");this.get("library").observe(wp.Uploader.queue);this.frame.on("content:render:browse",this.gallerySettings,this);a.controller.Library.prototype.activate.apply(this,arguments)},deactivate:function(){this.get("library").unobserve(wp.Uploader.queue);this.frame.off("content:render:browse",
this.gallerySettings,this);a.controller.Library.prototype.deactivate.apply(this,arguments)},gallerySettings:function(c){if(this.get("displaySettings")){var b=this.get("library");b&&c&&(b.gallery=b.gallery||new Backbone.Model,c.sidebar.set({document_gallery:new a.view.Settings.DocumentGallery({controller:this,model:b.gallery,priority:40})}),c.toolbar.set("reverse",{text:l10n.reverseOrder,priority:80,click:function(){b.reset(b.toArray().reverse())}}))}}});a.controller.DocumentGalleryAdd=a.controller.Library.extend({defaults:f.defaults({id:"document-gallery-library",
title:l10n.addToDocumentGalleryTitle,multiple:"add",filterable:"uploaded",menu:"document-gallery",toolbar:"document-gallery-add",priority:100,syncSelection:!1},a.controller.Library.prototype.defaults),initialize:function(){this.get("library")||this.set("library",a.query());a.controller.Library.prototype.initialize.apply(this,arguments)},activate:function(){var c=this.get("library"),b=this.frame.state("document-gallery-edit").get("library");this.editLibrary&&this.editLibrary!==b&&c.unobserve(this.editLibrary);
c.validator=function(c){return!!this.mirroring.get(c.cid)&&!b.get(c.cid)&&a.model.Selection.prototype.validator.apply(this,arguments)};c.reset(c.mirroring.models,{silent:!0});c.observe(b);this.editLibrary=b;a.controller.Library.prototype.activate.apply(this,arguments)}});a.view.Settings.DocumentGallery=a.view.Settings.extend({className:"collection-settings gallery-settings document-gallery-settings",template:a.template("document-gallery-settings")});var d=wp.media.view.MediaFrame.Post;wp.media.view.MediaFrame.Post=
d.extend({initialize:function(){d.prototype.initialize.apply(this,arguments);this.states.add([new a.controller.Library({id:"document-gallery",title:l10n.documentGalleryMenuTitle,priority:50,toolbar:"main-document-gallery",filterable:"all",multiple:"add",editable:!1,library:a.query(this.options.library)}),new a.controller.DocumentGalleryEdit({library:this.options.selection,editing:this.options.editing,menu:"document-gallery"}),new a.controller.DocumentGalleryAdd]);this.on("menu:create:document-gallery",
this.createMenu,this);this.on("toolbar:create:main-document-gallery",this.createToolbar,this);this.on("menu:render:document-gallery",this.documentGalleryMenu,this);this.on("toolbar:render:main-document-gallery",this.mainDocumentGalleryToolbar,this);this.on("toolbar:render:document-gallery-edit",this.documentGalleryEditToolbar,this);this.on("toolbar:render:document-gallery-add",this.documentGalleryAddToolbar,this)},documentGalleryMenu:function(c){var b=this.lastState(),e=b&&b.id,d=this;c.set({cancel:{text:l10n.cancelDocumentGalleryTitle,
priority:20,click:function(){e?d.setState(e):d.close();this.controller.modal.focusManager.focus()}},separateCancel:new a.View({className:"separator",priority:40})})},mainDocumentGalleryToolbar:function(a){var b=this;this.selectionStatusToolbar(a);a.set("document-gallery",{style:"primary",text:l10n.documentGalleryButton,priority:60,requires:{selection:!0},click:function(){var a=b.state().get("selection");b.state("document-gallery-edit").set("library",a);this.controller.setState("document-gallery-edit");
this.controller.modal.focusManager.focus()}})},documentGalleryEditToolbar:function(){var c=this.state().get("editing");this.toolbar.set(new a.view.Toolbar({controller:this,items:{insert:{style:"primary",text:c?l10n.updateDocumentGallery:l10n.insertDocumentGallery,priority:80,requires:{library:!0},click:function(){var a=this.controller,c=a.state();a.close();wp.media.editor.insert(wp.media.gallery.shortcode(c.get("library")).string().replace(/^\[gallery/ig,"[dg").replace(/DGorderby/ig,"orderby"));a.setState(a.options.state);
a.reset()}}}}))},documentGalleryAddToolbar:function(){this.toolbar.set(new a.view.Toolbar({controller:this,items:{insert:{style:"primary",text:l10n.addToDocumentGallery,priority:80,requires:{selection:!0},click:function(){var a=this.controller,b=a.state();a.state("document-gallery-edit").get("library").add(b.get("selection").models);b.trigger("reset");a.setState("document-gallery-edit")}}}}))}})})(jQuery,_);
