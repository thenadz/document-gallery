jQuery(document).ready(function(){function l(a){a=a||event;if(a.dataTransfer.types)for(var b=0;b<a.dataTransfer.types.length;b++)if("Files"==a.dataTransfer.types[b]){a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect="none";break}}function p(a){a=a||event;if(a.originalEvent.dataTransfer.types)for(var b=0;b<a.originalEvent.dataTransfer.types.length;b++)if("Files"==a.originalEvent.dataTransfer.types[b])return a.stopPropagation(),a.preventDefault(),a.originalEvent.dataTransfer.dropEffect=
"move",!1}function q(a){a=a||event;if(a.originalEvent.dataTransfer.types)for(var b=0;b<a.originalEvent.dataTransfer.types.length;b++)if("Files"==a.originalEvent.dataTransfer.types[b]){this.classList.add("dragover");f[jQuery(this).data("entry")]=f[jQuery(this).data("entry")].add(jQuery(a.target));break}}function r(a){a=a||event;if(a.originalEvent.dataTransfer.types)for(var b=0;b<a.originalEvent.dataTransfer.types.length;b++)if("Files"==a.originalEvent.dataTransfer.types[b]){f[jQuery(this).data("entry")]=
f[jQuery(this).data("entry")].not(a.target);0===f[jQuery(this).data("entry")].length&&this.classList.remove("dragover");break}}function t(a){a=a||event;if(a.originalEvent.dataTransfer.types)for(var b=0;b<a.originalEvent.dataTransfer.types.length;b++)if("Files"==a.originalEvent.dataTransfer.types[b]){a.stopPropagation();a.preventDefault();m(a.originalEvent.dataTransfer.files,jQuery(this).data("entry"));f[jQuery(this).data("entry")]=jQuery();this.classList.remove("dragover");break}}function u(a){a=
a||event;m(a.target.files,jQuery(this).closest("tr").data("entry"))}function m(a,b){for(var h=0,e;e=a[h];h++)if(0==e.type.indexOf("image/")&&"undefined"!=typeof dg_admin_vars.upload_limit&&e.size<=parseInt(dg_admin_vars.upload_limit)){var d=jQuery("[data-entry="+b+"]"),g=new FormData(d.closest("form")[0]);"undefined"!=typeof ajax_object&&"undefined"!=typeof ajax_object.ajax_url?(h=ajax_object.ajax_url,g.append("action","dg_upload_thumb")):h=jQuery("#tab-Thumbnail").attr("action");g.append("document_gallery[entry]",
b);g.append("document_gallery[ajax]","true");g.append("document_gallery[upload]","true");g.append("file",e);var c=new XMLHttpRequest;c.open("POST",h);var f=d.find(".column-icon img"),k=d.find(".progress > *:first");c.onreadystatechange=function(){if(4==c.readyState){if(200==c.status&&-1==c.responseText.indexOf("\n")){jQuery(k).parent().addClass("success");var a=jQuery.parseJSON(c.responseText);a.result&&(a.url===f.attr("src")?f.attr("src",f.attr("src")+"?"+(new Date).getTime()):f.attr("src",a.url))}else jQuery(k).parent().addClass("fail"),
console.log("Invalid response from server:"),console.log(c.responseText);setTimeout(function(){d.find(".column-thumbupload > *").toggleClass("invis");jQuery(k).parent().removeClass("success fail")},5E3)}};c.onload=function(){k.width("100%")};c.upload.onprogress=function(a){a.lengthComputable&&k.width((a.loaded/a.total*100|0)+"%")};k.width(0);d.find(".column-thumbupload > *").toggleClass("invis");c.send(g);break}else console.log("Attempt to upload improper file %c"+e.name+":","font-weight:bold;"),
0!=e.type.indexOf("image/")&&console.log("\tIs not an image - "+e.type),"undefined"!=typeof dg_admin_vars.upload_limit&&e.size>parseInt(dg_admin_vars.upload_limit)&&console.log("\tIs too big - "+e.size+"b; (Limit is "+dg_admin_vars.upload_limit+"b)")}function n(a){for(var b=4,h=0;6>h;h++)a.animate({"margin-left":"+="+(b=-b)+"px"},50)}jQuery(".cb-ids").change(function(){jQuery(this).is(":checked")?jQuery(this).closest("tr").addClass("selected"):jQuery(this).closest("tr").removeClass("selected")});
jQuery("th input:checkbox").change(function(){jQuery(this).is(":checked")?jQuery("#ThumbsTable tbody tr").addClass("selected"):jQuery("#ThumbsTable tbody tr").removeClass("selected")});jQuery("input.current-page").bind("keypress",{},function(a){13==(a.keyCode?a.keyCode:a.which)&&(a.preventDefault(),jQuery(location).attr("href","?"+jQuery.param(jQuery.extend(URL_params,{sheet:this.value}))))});jQuery("select.limit_per_page").change(function(){jQuery(location).attr("href","?"+jQuery.param(jQuery.extend(URL_params,
{limit:this.value})))});jQuery("#tab-Thumbnail").submit(function(a){a.preventDefault();if(0<jQuery(".cb-ids:checked").length){a=jQuery(this).attr("action");var b=jQuery(this).serialize()+"&document_gallery%5Bajax%5D=true&document_gallery%5Bcleanup%5D=true";jQuery(".deleteSelected").addClass("waiting").attr("disabled","disabled");jQuery.post(a,b,function(a){if(a.result){a=a.deleted;for(var b in a)jQuery("input[type=checkbox][value="+a[b]+"]").closest("tr").fadeOut("slow",0,function(){jQuery(this).slideUp("slow",
function(){jQuery(this).remove()})})}jQuery(".deleteSelected").removeClass("waiting").removeAttr("disabled")}).fail(function(){console.log("Problem in reaching the server");jQuery(".deleteSelected").removeClass("waiting").removeAttr("disabled")})}return!1});jQuery("#tab-Advanced #options-dump").click(function(){jQuery(this).select()});jQuery(".expander").click(function(){getSelection().toString()||(jQuery(this).next().slideToggle("slow"),jQuery(this).find(".dashicons").toggleClass("dashicons-arrow-down-alt2 dashicons-arrow-up-alt2"),
jQuery(this).toggleClass("expander collapser"),jQuery(this).attr("title",jQuery(this).hasClass("expander")?"Click to Expand":"Click to Collapse"))});jQuery(".spoiler-body").length&&(jQuery(".expandAll, .collapseAll").addClass("button"),jQuery(".expandAll").click(function(a){a.preventDefault();jQuery(".expander").trigger("click")}),jQuery(".collapseAll").click(function(a){a.preventDefault();jQuery(".collapser").trigger("click")}));jQuery(".levelSelector input").change(function(){"all"==jQuery(this).val()?
(jQuery(".levelSelector input").not("[value='all']").prop("checked",jQuery(this).is(":checked")),jQuery(this).is(":checked")?jQuery("#LogTable tbody tr").show():jQuery("#LogTable tbody tr").hide()):(jQuery(this).is(":checked")?jQuery("#LogTable tbody tr:has(span."+jQuery(this).val()+")").show():jQuery("#LogTable tbody tr:has(span."+jQuery(this).val()+")").hide(),jQuery(".levelSelector input:checked").not("[value='all']").length+1==jQuery('.levelSelector input[type="checkbox"]').length?jQuery('.levelSelector input[value="all"]').prop("checked",
!0):jQuery('.levelSelector input[value="all"]').prop("checked",!1))});jQuery("#LogTable .manage-column.column-date").click(function(){jQuery(this).toggleClass("asc desc");var a=jQuery("#LogTable > tbody"),b=a.children("tr");a.append(b.get().reverse())});window.addEventListener("dragover",l,!1);window.addEventListener("drop",l,!1);var f={};jQuery("#ThumbsTable tbody tr").each(function(){jQuery(this).on("dragenter",q).on("dragover",p).on("dragleave",r).on("drop",t);f[jQuery(this).data("entry")]=jQuery();
jQuery(this).find("input:button").on("click",function(){jQuery(this).prevAll("input:file").click()});jQuery(this).find("input:file").on("change",u)});"draggable"in document.createElement("span")||jQuery(".html5dndmarker").hide();jQuery("td .dashicons-edit").click(function(){var a=jQuery(this).closest("td");if(a.hasClass("column-title")){if("none"==a.find("a").css("display"))return;a.find("a").hide().after('<input type="text" value="'+a.find(".editable-title").text()+'">');a.find("input").focus()}else if(a.hasClass("column-description")){if("none"==
a.find(".editable-description").css("display"))return;a.find(".editable-description").hide().after("<textarea>"+a.find(".editable-description").html()+"</textarea>");a.find("textarea").focus()}else return;jQuery(this).css("visibility","hidden");a.find(".edit-controls").show()});jQuery(".edit-controls .dashicons-no").click(function(){var a=jQuery(this).closest("td");if(a.hasClass("column-title")){if("none"!=a.find("a").css("display"))return;a.find("input").fadeOut("fast",function(){jQuery(this).remove();
a.find("a").fadeIn("fast")})}else if(a.hasClass("column-description")){if("none"!=a.find(".editable-description").css("display"))return;a.find("textarea").fadeOut("fast",function(){jQuery(this).remove();a.find(".editable-description").fadeIn("fast")})}else return;jQuery(this).closest(".edit-controls").hide();a.find(".dashicons-edit").css("visibility","visible")});jQuery(".edit-controls .dashicons-yes").click(function(){var a=jQuery(this).closest("td"),b=jQuery(this).closest("tr").data("entry"),f=
jQuery("#tab-Thumbnail").attr("action"),e=new FormData(jQuery("[data-entry="+b+"]").closest("form")[0]);e.append("document_gallery[entry]",b);e.append("document_gallery[ajax]","true");var d,g;if(a.hasClass("column-title"))d=a.find("input"),g=a.find(".editable-title"),e.append("document_gallery[title]",encodeURIComponent(d.val()));else if(a.hasClass("column-description"))d=a.find("textarea"),g=a.find(".editable-description"),e.append("document_gallery[description]",encodeURIComponent(d.val()));else return;
if(d.val()==g.text()||a.hasClass("column-description")&&d.val()==g.html())jQuery(this).next(".dashicons-no").click();else{var c=new XMLHttpRequest;c.open("POST",f);c.onreadystatechange=function(){4==c.readyState&&(a.addClass("trans"),a.find(".edit-controls").removeClass("waiting"),-1==c.responseText.indexOf("\n")?jQuery.parseJSON(c.responseText).result?(a.hasClass("column-description")?g.html(d.val()):g.text(d.val()),a.find(".dashicons-no").click(),a.addClass("responseSuccess").delay(2E3).queue(function(){jQuery(this).removeClass("responseSuccess").dequeue()}).delay(1100).queue(function(){jQuery(this).removeClass("trans").dequeue()})):
(n(d),a.addClass("responseFail").delay(1100).queue(function(){jQuery(this).removeClass("responseFail").dequeue()}).delay(1100).queue(function(){jQuery(this).removeClass("trans").dequeue()})):(n(d),a.addClass("responseFail").delay(1100).queue(function(){jQuery(this).removeClass("responseFail").dequeue()}).delay(1100).queue(function(){jQuery(this).removeClass("trans").dequeue()}),console.log("Invalid response from server:"),console.log(c.responseText)))};jQuery(this).closest(".edit-controls").addClass("waiting");
c.send(e)}})});
